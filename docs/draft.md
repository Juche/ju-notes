# 笔记草稿

Object.create() 方法用于创建一个新对象，使用现有的对象来作为新创建对象的原型（prototype）

## 跨域

> 尽管很多的验证与鉴权是由服务端完成，但是本质上大部分的检查和限制还是应该由浏览器完成。
> 一般来说 CORS 会分为 Simple Request(简单请求) 与 Preflight(需要预检)的请求两大类。
> 预检请求会在正式通信之前，增加一次 HTTP 查询请求。浏览器先询问服务器，当前网页所在的域名是否在服务器的许可名单之中，以及可以使用哪些 HTTP 动词和头信息字段。只有得到肯定答复，浏览器才会发出正式的 XMLHttpRequest 请求，否则就报错。

- 浏览器的拦截策略: 协议、域名、端口中有一个不同就会跨域, 谷歌浏览器视 file 协议为跨域
- 需服务端配合不同跨域方案
  - fetch / http-request
    - `Fetch Api` 必须后台支持 `CORS`,。如果你设置了 `{mode: ' cors '}`(一般用于请求 API)，就会报错告诉你你请求的服务器不支持 `CORS`。
    - 如果设置成 `{mode: ' no-cors '}` (一般用于请求图片等静态资源), 虽然不会报错，但是结果会 返回被标记了为 `opaque` 的数据，表明你没有权限访问。
  - JSONP(仅适用于 GET 请求) => demo: `code\js\jsonp`
    - JSONP 的理念就是，我和服务端约定好一个函数名，当我请求文件的时候，服务端返回一段 JavaScript。这段 JavaScript 调用了我们约定好的函数，并且将数据当做参数传入。
  - nginx 反向代理

## 图片下载

- a 标签下载文件的策略 => 浏览器支持浏览的格式会默认打开
- 强行使用浏览下载弹窗接管默认对图片的打开行为
- 下载文件的文件名指定
- 默认打开再`另存为`和唤起下载窗行为无法动态指定命名
- 对于图片文件下载最佳实践
  - 通过网络请求文件获取 blob 格式的 url 然后再作为 a 标签的 herf 使用下载模式
    - 对本地资源有效
    - 对同网网络协议(或者同域)的网络资源有效
  - 对于其他网络资源通过上面主动唤起下载窗是目前较好的方案

## 页面生成图片 & 分享

> 机微信浏览器中打开的 H5 页面，是无法通过 JavaScript 的 API 实现图片或文件下载的
> 微信浏览器支持长按图片保存
> 长按图片保存的操作逻辑不是所有浏览器都支持(比如 safari)

- 页面生成图片可直接用第三方页面转 canvas 的封装
- 获取 canvas 的 ObjectUrl,通过 img 标签弹窗展示
- 页面图片的分享可根据浏览器环境区分交互模式
  - 微信环境: 通过长按图片触发交互上下文
  - 浏览器: 提供下载按钮,点击通过生成下载模式的 a 标点 & js 模拟点击事件来触发下载(当前资源属于本地资源,可直接静默下载)
- 其他方案 => 微信的 JS-SDK (非迫不得已不推荐)

## 动态尺寸裁剪

- 纯暴力数据计算 & 动态占据屏幕合理的比例(计算量巨大)
- 固定一个合理的宽度(`3 * 4 * 5 * 7 * 9...`) & 使用响应式单位
